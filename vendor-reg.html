<!DOCTYPE html>
<html lang="ha">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafita Dubu | Vendor Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@800&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --milk-bg: #FFF5E1; --royal-black: #1a1405; --gold: #bf953f; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--milk-bg); display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 20px; }
        .luxury-card { background: var(--royal-black); border: 2px solid var(--gold); border-radius: 40px 10px; padding: 30px; width: 100%; max-width: 450px; color: white; }
        .step-layer { display: none; }
        .active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .gold-input { width: 100%; background: #2a2210; border: 1px solid var(--gold); padding: 12px; border-radius: 10px; color: white; margin-bottom: 10px; }
        .primary-btn { background: linear-gradient(135deg, #bf953f, #fcf6ba); color: #000; font-weight: 800; width: 100%; padding: 14px; border-radius: 10px; cursor: pointer; border: none; }
        .scanner-box { width: 100%; height: 200px; background: #000; border-radius: 15px; position: relative; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

<div class="luxury-card">
    <h2 style="font-family: 'Cinzel'; color: #fcf6ba; text-align: center; margin-bottom: 20px;">Vendor Setup</h2>

    <div class="step-layer active" id="layer1">
        <input type="text" id="bizName" class="gold-input" placeholder="Business Name (Suna)">
        <select id="bizType" class="gold-input" onchange="startGPS()">
            <option value="">-- Select Category --</option>
            <option value="Store">Physical Store</option>
            <option value="Home">Home-Based</option>
        </select>
        <div id="gps-status" style="font-size: 0.75rem; color: #ff4d4d; margin-bottom: 10px;">üìç GPS: Not Fixed</div>
        <button class="primary-btn" onclick="validateLayer1()">NEXT: AI SCAN</button>
    </div>

    <div class="step-layer" id="layer2">
        <div class="scanner-box">
            <video id="webcam" autoplay playsinline></video>
        </div>
        <p id="ai-msg" style="text-align:center; font-size: 0.8rem; margin: 10px 0;">[ INITIALIZING SCAN... ]</p>
        <button class="primary-btn" id="camBtn" disabled onclick="goToLayer(3)">CONTINUE</button>
    </div>

    <div class="step-layer" id="layer3">
        <div id="items-list">
            <input type="text" class="gold-input item-name" placeholder="Item Name">
            <input type="number" class="gold-input item-price" placeholder="Price">
        </div>
        <button class="primary-btn" onclick="saveToFirebase()">FINISH & UPLOAD</button>
    </div>
</div>

<script>
    // 1. Firebase Initialize
    const firebaseConfig = {
        apiKey: "AIzaSyDJfUePiQV5R1YAcnq-zvfd3ty4lbzDs1M",
        authDomain: "global-market-admin.firebaseapp.com",
        projectId: "global-market-admin",
        storageBucket: "global-market-admin.firebasestorage.app",
        messagingSenderId: "259715265619",
        appId: "1:259715265619:web:313919773f57cc5fb9c2a6"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let vendorLocation = null;

    // 2. GPS Logic
    function startGPS() {
        const status = document.getElementById('gps-status');
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                vendorLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                status.innerText = `üìç GPS Fixed: ${vendorLocation.lat.toFixed(4)}, ${vendorLocation.lng.toFixed(4)}`;
                status.style.color = "#00ffcc";
            }, () => { alert("Please enable Location!"); });
        }
    }

    // 3. Navigation & Validation
    function validateLayer1() {
        if(!document.getElementById('bizName').value || !vendorLocation) {
            alert("Saka Suna sannan ka tabbatar GPS ya nuna!");
            return;
        }
        goToLayer(2);
        startCamera();
    }

    function goToLayer(n) {
        document.querySelectorAll('.step-layer').forEach(l => l.classList.remove('active'));
        document.getElementById('layer' + n).classList.add('active');
    }

    // 4. Camera
    async function startCamera() {
        const video = document.getElementById('webcam');
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream;
        setTimeout(() => {
            document.getElementById('ai-msg').innerText = "‚úÖ SCAN SUCCESSFUL";
            document.getElementById('camBtn').disabled = false;
        }, 3000);
    }

    // 5. UPLOAD TO FIREBASE
    async function saveToFirebase() {
        const btn = event.target;
        btn.innerText = "UPLOADING...";
        btn.disabled = true;

        const data = {
            name: document.getElementById('bizName').value,
            type: document.getElementById('bizType').value,
            location: vendorLocation,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            await db.collection("vendors").add(data);
            alert("Masha Allah! An tura bayanan zuwa Database.");
            location.reload();
        } catch (e) {
            alert("Error: " + e.message);
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
